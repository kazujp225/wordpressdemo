# プラン・価格設計ドキュメント

## プラン一覧

| プラン | 月額 | クレジット | Stripe Price ID |
|--------|------|-----------|-----------------|
| Free | ¥0 | 0 | なし |
| Starter | ¥10,000 | 25,000 | `STRIPE_PRICE_STARTER` |
| Pro | ¥30,000 | 75,000 | `STRIPE_PRICE_PRO` |
| Business | ¥50,000 | 125,000 | `STRIPE_PRICE_BUSINESS` |
| Enterprise | ¥100,000 | 250,000 | `STRIPE_PRICE_ENTERPRISE` |
| Unlimited | ¥500,000 | 1,250,000 | `STRIPE_PRICE_UNLIMITED` |

## クレジット計算ロジック

- 1円 = 10クレジット
- 月額の25%をクレジットとして付与
- 例: ¥10,000プラン → ¥2,500分 = 25,000クレジット

## 機能制限（プラン別）

### Freeプランで使える機能（API課金なし）

以下の機能はFreeプランでも制限なく使える（APIコストが発生しない機能）：

- ページインポート（faithfulモード = スクショそのまま分割）
- ページ編集（テキスト・レイアウト変更等）
- 画像アップロード
- バナー作成・管理
- メディアライブラリ
- エクスポート機能
- ページ公開（最大3ページ）
- お問い合わせ送信
- パスワード変更
- 設定変更

### 有料プランのみの機能（AI/APIコストが発生する機能）

以下の機能はAPI課金が発生するため、有料プラン（Starter以上）が必要：

| 機能 | Starter | Pro | Business | Enterprise | Unlimited |
|------|---------|-----|----------|-----------|-----------|
| AI画像生成 | ✅ | ✅ | ✅ | ✅ | ✅ |
| インペイント編集 | ✅ | ✅ | ✅ | ✅ | ✅ |
| ページインポート（AIアレンジ） | ✅ | ✅ | ✅ | ✅ | ✅ |
| 一括AI再生成 | ✅ | ✅ | ✅ | ✅ | ✅ |
| SEO/LLMO分析 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 配色AI提案 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 4Kアップスケール | ❌ | ✅ | ✅ | ✅ | ✅ |
| リスタイル | ❌ | ✅ | ✅ | ✅ | ✅ |
| 動画生成 | ❌ | ❌ | ✅ | ✅ | ✅ |

### ページ・ストレージ制限

| プラン | 最大ページ数 | ストレージ |
|--------|------------|-----------|
| Free | 3 | 500MB |
| Starter | 10 | 5GB |
| Pro | 30 | 10GB |
| Business | 50 | 20GB |
| Enterprise | 無制限 | 無制限 |
| Unlimited | 無制限 | 無制限 |

## 判定ルール

### Freeプランユーザーがアクセスした場合

1. **ページインポート**: faithfulモード（スクショそのまま）は許可。AIアレンジモードは自動的にfaithfulにフォールバック
2. **AI画像生成/編集**: ブロック。アップグレード促進トーストを表示
3. **エクスポート**: 許可
4. **ページ作成**: 3ページまで許可

### クレジットチェック

- 有料プランでもクレジット残高が0の場合はAI機能をブロック
- 追加クレジット購入で残高を補充可能

## 実装箇所

- プラン定義: `src/lib/plans.ts`
- 使用量チェック: `src/lib/usage.ts`
- クレジット管理: `src/lib/credits.ts`
- Stripe連携: `src/lib/stripe.ts`
- Webhookハンドラ: `src/app/api/webhooks/stripe/route.ts`
