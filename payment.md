# API課金一覧 (Payment & Cost Reference)

このドキュメントは、LP Builderで使用されるすべての課金対象APIエンドポイントをまとめたものです。

---

## 料金体系

### Gemini API 料金 (2024年時点)

| モデル | タイプ | 料金 |
|--------|--------|------|
| `gemini-3-pro-image-preview` | 画像生成 | **$0.04/画像** (~6円) |
| `gemini-2.5-flash-preview-image-generation` | 画像生成（フォールバック） | **$0.02/画像** (~3円) |
| `gemini-2.0-flash` | テキスト | $0.075/100万入力トークン + $0.30/100万出力トークン |
| `gemini-1.5-flash` | テキスト | $0.075/100万入力トークン + $0.30/100万出力トークン |

**注意**: `gemini-3.0-flash-preview`や`gemini-1.5-flash-8b`は存在しないモデルです。

---

## 画像生成API（高コスト）

### 1. セクション再生成
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/sections/[id]/regenerate` |
| **モデル** | `gemini-3-pro-image-preview` |
| **コスト** | **$0.04/回** (~6円) |
| **用途** | セクション画像の再生成、スタイル変更、カラーパレット適用 |
| **呼び出し元** | カラーパレット適用、コピー編集後の再生成、一括リスタイル |

### 2. 画像生成
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/ai/generate-image` |
| **モデル** | `gemini-3-pro-image-preview` (フォールバック: `gemini-2.5-flash-preview-image-generation`) |
| **コスト** | **$0.04/回** (~6円)、フォールバック時 $0.02/回 |
| **用途** | 新規画像生成、4K出力対応 |

### 3. インペイント（部分編集）
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/ai/inpaint` |
| **モデル** | `gemini-3-pro-image-preview` |
| **コスト** | **$0.04/回** (~6円) |
| **用途** | 画像の一部を選択して編集、マスク指定での再生成 |

### 4. 画像編集
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/ai/edit-image` |
| **モデル** | `gemini-3-pro-image-preview` (フォールバック: `gemini-2.5-flash-preview-image-generation`) |
| **コスト** | **$0.04/回** (~6円) |
| **用途** | リブランド、リスタイル操作 |

### 5. テキスト修正
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/ai/text-fix` |
| **モデル** | `gemini-3-pro-image-preview` |
| **コスト** | **$0.04/回** (~6円) |
| **用途** | 画像内の日本語テキスト修正、4K出力 |

### 6. 背景統一
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/ai/background-unify` |
| **モデル** | `gemini-3-pro-image-preview` |
| **コスト** | **$0.04/回** (~6円) |
| **用途** | 複数セクションの背景色を統一、1K/2K/4K解像度対応 |

### 7. デザイン統一
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/ai/design-unify` |
| **モデル** | `gemini-3-pro-image-preview` |
| **コスト** | **$0.04/回** (~6円) |
| **用途** | 参照画像に基づくデザインスタイルの統一 |

### 8. セクション生成
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/sections/generate` |
| **モデル** | `gemini-3-pro-image-preview` |
| **コスト** | **$0.04/回** (~6円) |
| **用途** | 隣接セクションを考慮した新規セクション生成 |

### 9. 境界デザイン
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/sections/boundary-design` |
| **モデル** | `gemini-3-pro-image-preview` |
| **コスト** | **$0.04/回** (~6円) |
| **用途** | セクション間の境界を滑らかに接続 |

### 10. ページリスタイル（一括）
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/pages/[id]/restyle` |
| **モデル** | `gemini-3-pro-image-preview` |
| **コスト** | **$0.04 × セクション数** |
| **用途** | ページ全体のスタイル変更、デスクトップ+モバイル対応 |
| **例** | 10セクション = $0.40 (~60円) |

### 11. 4Kアップスケール
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/pages/[id]/upscale-4k` |
| **モデル** | `gemini-3-pro-image-preview` |
| **コスト** | **$0.04 × セクション数** |
| **用途** | 高解像度化、Real-ESRGANフォールバックあり（無料） |

### 12. LP Builder 生成
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/lp-builder/generate` |
| **モデル** | `gemini-3-pro-image-preview` (フォールバック: `gemini-2.5-flash-image`) |
| **コスト** | **$0.04 × セクション数** |
| **用途** | LPの一括生成、Style Anchor + Seam Reference |
| **例** | 8セクション = $0.32 (~48円) |

### 13. URL インポート
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/import-url` |
| **モデル** | `gemini-3-pro-image-preview` |
| **コスト** | **$0.04 × セグメント数** (最大10) |
| **用途** | URLからスクリーンショット取得 → AI処理 |
| **例** | 10セグメント = $0.40 (~60円) |

---

## テキスト生成API（低コスト）

### 14. コピー生成
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/ai/generate-copy` |
| **モデル** | `gemini-3.0-flash-preview` / `gemini-2.0-flash` |
| **コスト** | **~$0.001/回** (~0.15円) |
| **用途** | AIキャッチコピー生成、セクションごとのテキスト作成 |

### 15. デザイン解析
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/ai/analyze-design` |
| **モデル** | `gemini-2.0-flash` |
| **コスト** | **~$0.001/回** (~0.15円) |
| **用途** | 画像からデザイン定義を抽出、カラーパレット検出 |

### 16. チャット編集
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/ai/chat-edit` |
| **モデル** | `gemini-2.0-flash` |
| **コスト** | **~$0.0003/回** (~0.05円) |
| **用途** | チャット形式でのコピー改善 |

### 17. ナビゲーション生成
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/ai/generate-nav` |
| **モデル** | `gemini-2.0-flash` |
| **コスト** | **~$0.0003/回** (~0.05円) |
| **用途** | LP画像からナビゲーション構造を自動生成 |

### 18. 画像→プロンプト
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/ai/image-to-prompt` |
| **モデル** | `gemini-2.0-flash` |
| **コスト** | **~$0.0003/回** (~0.05円) |
| **用途** | 画像からプロンプトを生成（英語+日本語） |

### 19. コピーレビュー
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/ai/review` |
| **モデル** | `gemini-2.0-flash` |
| **コスト** | **~$0.0003/回** (~0.05円) |
| **用途** | コピーの品質レビュー（法的、ブランド、マーケティング観点） |

### 20. プロンプトコパイロット
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/ai/prompt-copilot` |
| **モデル** | `gemini-2.0-flash` |
| **コスト** | **~$0.0003/回** (~0.05円) |
| **用途** | プロンプト作成のチャットアシスタント |
| **備考** | 管理者APIキー使用（ユーザー課金なし） |

### 21. OCR
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/ai/ocr` |
| **モデル** | `gemini-2.0-flash` |
| **コスト** | **~$0.0005/回** (~0.08円) |
| **用途** | 画像からテキスト抽出（最大4画像/回） |

---

## 無料/ローカル処理

### 22. アップスケール
| 項目 | 詳細 |
|------|------|
| **エンドポイント** | `/api/ai/upscale` |
| **モデル** | `real-esrgan-thick` (ローカル) / `gemini-3-pro-image-preview` (フォールバック) |
| **コスト** | **無料** (Real-ESRGAN) / $0.04 (AIフォールバック時) |
| **用途** | 画像の高解像度化 |

---

## 機能別コスト概算

### コピー編集 → 再生成 フロー
```
1. コピー生成: ~$0.001 × セクション数
2. 画像再生成: $0.04 × セクション数
---
合計: 10セクションで約 $0.41 (~62円)
```

### カラーパレット適用 → 再生成 フロー
```
1. デザイン解析: ~$0.001
2. 画像再生成: $0.04 × セクション数
---
合計: 10セクションで約 $0.40 (~60円)
```

### 新規LP作成（フル）
```
1. LP生成: $0.04 × 8セクション = $0.32
2. コピー生成: ~$0.008
3. ナビ生成: ~$0.0003
---
合計: 約 $0.33 (~50円)
```

### URLインポート → リスタイル
```
1. URLインポート: $0.04 × 10セグメント = $0.40
2. デザイン解析: ~$0.001
3. リスタイル: $0.04 × 10セクション = $0.40
---
合計: 約 $0.80 (~120円)
```

---

## コスト管理のヒント

1. **フォールバックモデル**: 多くのエンドポイントは失敗時に安価なモデルにフォールバック
2. **Real-ESRGAN**: アップスケールはローカル処理が優先（無料）
3. **バッチ処理**: 一括操作でもセクション単位で課金
4. **プレビュー**: デザイン解析やコピー生成はテキストモデルなので低コスト
5. **API使用量**: `/admin/api-usage` ページで使用量を確認可能

---

## ログ記録

すべてのAPI呼び出しは `GenerationRun` テーブルに記録されます：
- ユーザーID
- 使用モデル
- 推定コスト
- 実行時間
- 成功/失敗ステータス

確認: `/admin/api-usage` ページ

---

*最終更新: 2024年*
